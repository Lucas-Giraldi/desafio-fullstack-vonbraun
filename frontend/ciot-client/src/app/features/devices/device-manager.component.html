<div class="menu">
  <button class="menu-btn" (click)="getAllDevices()">ğŸ”„ Get All</button>
  <button class="menu-btn" (click)="openGetByIdModal()">ğŸ” Get By Id</button>
  <button class="menu-btn" (click)="openCreateModal()">â• Create</button>
</div>

<h2 class="title">ğŸ“‹ Lista de Dispositivos</h2>

<div *ngIf="loading" class="loading">â³ Carregando dispositivos...</div>
<div *ngIf="error" class="error">âŒ {{ error }}</div>

<div *ngIf="!loading && !error && devices.length > 0" class="device-list">
  <div *ngFor="let device of devices" class="device-card">
    <div class="device-header">
      <h3>{{ device.identifier }}</h3>

      <select [(ngModel)]="selectedCommands[device.identifier]" class="command-select">
        <option *ngFor="let cmd of device.commands" [value]="cmd.operation">
          {{ cmd.operation }}
        </option>
      </select>

      <input
        *ngIf="hasParameters(device.identifier)"
        [(ngModel)]="commandParameters[device.identifier]"
        placeholder="ParÃ¢metro"
        class="param-input"
      />

      <button class="execute-btn" (click)="executeDevice(device.identifier)">âš¡ Execute</button>

      <div *ngIf="executionResults[device.identifier]" 
           [ngClass]="{'execution-success': executionResults[device.identifier].status === 'success',
                       'execution-error': executionResults[device.identifier].status === 'error'}"
           class="execution-result">
        <strong>
          <span *ngIf="executionResults[device.identifier].status === 'success'">ğŸŸ¢</span>
          <span *ngIf="executionResults[device.identifier].status === 'error'">ğŸ”´</span>
          Resultado:
        </strong>
        {{ executionResults[device.identifier].message }}
      </div>
    </div>

    <div class="device-info">
      <p><strong>DescriÃ§Ã£o:</strong> {{ device.description }}</p>
      <p><strong>Fabricante:</strong> {{ device.manufacturer }}</p>
      <p><strong>URL:</strong> {{ device.url }}</p>
    </div>

    <div class="json-block">
      <pre><code [innerHTML]="formatJson(device)"></code></pre>
    </div>
  </div>
</div>

<app-device-modal
  *ngIf="showModal"
  [initialData]="newDevice"
  (submit)="handleCreate($event)"
  (cancel)="showModal = false">
</app-device-modal>

<app-device-by-id-modal
  *ngIf="showGetByIdModal"
  (close)="showGetByIdModal = false"
  (deviceFound)="handleDeviceById($event)">
</app-device-by-id-modal>
